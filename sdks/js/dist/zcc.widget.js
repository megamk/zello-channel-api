!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Widget=n():(e.ZCC=e.ZCC||{},e.ZCC.Widget=n())}(window,function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=20)}([function(e,n,t){"use strict";e.exports={ERROR_NOT_ENOUGH_PARAMS:"Not enough parameters",ERROR_INVALID_SERVER_PROTOCOL:"Invalid server protocol, use ws:// or wss://",ERROR_UNSUPPORTED:"Your browser does not support all required APIs.\nRead more here https://github.com/zelloptt/zello-channel-api",ERROR_RECORDING_NO_HTTPS:"Recording will work over https:// loaded pages only",ERROR_WIDGET_ELEMENT_NOT_FOUND:"DOM element for widget is not found",ERROR_INVALID_DECODER:"Invalid incoming message decoder. Should be a function that creates and returns decoder instance.",ERROR_INVALID_PLAYER:"Invalid incoming message decoder. Should be a function that creates and returns player instance.",EVENT_ERROR:"error",EVENT_CONNECT:"connect",EVENT_CLOSE:"close",EVENT_LOGON:"logon",EVENT_STATUS:"status",EVENT_BUTTON_PRESS:"button_press",EVENT_START_STREAM:"start_stream",EVENT_STOP_STREAM:"stop_stream",EVENT_SESSION_START_CONNECT:"session_start_connect",EVENT_SESSION_CONNECT:"session_connect",EVENT_SESSION_FAIL_CONNECT:"session_fail_connect",EVENT_SESSION_CONNECTION_LOST:"session_connection_lost",EVENT_SESSION_DISCONNECT:"session_disconnect",EVENT_INCOMING_VOICE_WILL_START:"incoming_voice_will_start",EVENT_INCOMING_VOICE_DID_START:"incoming_voice_did_start",EVENT_INCOMING_VOICE_DID_STOP:"incoming_voice_did_stop",EVENT_INCOMING_VOICE_DATA:"incoming_voice_data",EVENT_INCOMING_VOICE_DATA_DECODED:"incoming_voice_data_decoded"}},function(e,n,t){"use strict";e.exports={libraryName:"ZCC"}},function(e,n,t){"use strict";var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=t(1),o=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"getLoadedLibrary",value:function(){return!!window&&window[i.libraryName]}},{key:"strToCamelCase",value:function(e){return e.split(/[-_]/).map(function(e,n){return 0===n?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}).join("")}}]),e}();e.exports=o},function(e,n,t){function r(e){if(e)return function(e){for(var n in r.prototype)e[n]=r.prototype[n];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(n),this},r.prototype.once=function(e,n){function t(){this.off(e,t),n.apply(this,arguments)}return t.fn=n,this.on(e,t),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,n){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var t,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((t=r[i])===n||t.fn===n){r.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var n=[].slice.call(arguments,1),t=this._callbacks["$"+e];if(t)for(var r=0,i=(t=t.slice(0)).length;r<i;++r)t[r].apply(this,n);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},,,,,,,,,function(module,exports){module.exports=function anonymous(locals,filters,escape,rethrow){escape=escape||function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};var __stack={lineno:1,input:"<%if (status === 'online') {%>\n    <span>Online users:</span> <span><%= users_online %></span>\n<%} else {%>\n    <span>You are not connected.</span>\n<%}%>",filename:"."};function rethrow(e,n,t,r){var i=n.split("\n"),o=Math.max(r-3,0),s=Math.min(i.length,r+3),a=i.slice(o,s).map(function(e,n){var t=n+o+1;return(t==r?" >> ":"    ")+t+"| "+e}).join("\n");throw e.path=t,e.message=(t||"ejs")+":"+r+"\n"+a+"\n\n"+e.message,e}try{var buf=[];with(locals||{})buf.push(""),__stack.lineno=1,"online"===status?(buf.push("\n    <span>Online users:</span> <span>",escape((__stack.lineno=2,users_online)),"</span>\n"),__stack.lineno=3):(buf.push("\n    <span>You are not connected.</span>\n"),__stack.lineno=5),buf.push("");return buf.join("")}catch(err){rethrow(err,__stack.input,__stack.filename,__stack.lineno)}}},function(module,exports){module.exports=function anonymous(locals,filters,escape,rethrow){escape=escape||function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};var __stack={lineno:1,input:'<div class="zcc-widget-container zcc-js-el">\n    <div class="zcc-row">\n        \x3c!--<div class="zcc-cell">\n            <div class="zcc-talk-button-container">\n                <button class="zcc-talk-button"></button>\n            </div>\n        </div>--\x3e\n        <div class="zcc-main-info-container zcc-cell zcc-js-el">\n            <div class="zcc-row">\n                <h4 class="zcc-info-header zcc-js-el">[channel title]</h4>\n            </div>\n            <div class="zcc-row">\n                <div class="zcc-state zcc-js-el">\n                    <%- include ./src/classes/widget/templates/status.ejs %>\n                </div>\n            </div>\n        </div>\n        \x3c!--<div class="zcc-row">\n            <div class="zcc-cell">\n                <div class="zcc-status-container"></div>\n            </div>\n        </div>\n        <div class="zcc-row">\n            <div class="zcc-cell">\n                <div class="zcc-message-container">\n                    <div class="zcc-message-info-container"></div>\n                    <div class="zcc-message-duration-container"></div>\n                </div>\n            </div>\n        </div>--\x3e\n\n    </div>\n</div>',filename:"."},e;function rethrow(e,n,t,r){var i=n.split("\n"),o=Math.max(r-3,0),s=Math.min(i.length,r+3),a=i.slice(o,s).map(function(e,n){var t=n+o+1;return(t==r?" >> ":"    ")+t+"| "+e}).join("\n");throw e.path=t,e.message=(t||"ejs")+":"+r+"\n"+a+"\n\n"+e.message,e}try{var buf=[];with(locals||{})buf.push('<div class="zcc-widget-container zcc-js-el">\n    <div class="zcc-row">\n        \x3c!--<div class="zcc-cell">\n            <div class="zcc-talk-button-container">\n                <button class="zcc-talk-button"></button>\n            </div>\n        </div>--\x3e\n        <div class="zcc-main-info-container zcc-cell zcc-js-el">\n            <div class="zcc-row">\n                <h4 class="zcc-info-header zcc-js-el">[channel title]</h4>\n            </div>\n            <div class="zcc-row">\n                <div class="zcc-state zcc-js-el">\n                    '+(e=[],e.push(""),__stack.lineno=1,"online"===status?(e.push("\n    <span>Online users:</span> <span>",escape((__stack.lineno=2,users_online)),"</span>\n"),__stack.lineno=3):(e.push("\n    <span>You are not connected.</span>\n"),__stack.lineno=5),e.push(""),e.join(""))+'\n                </div>\n            </div>\n        </div>\n        \x3c!--<div class="zcc-row">\n            <div class="zcc-cell">\n                <div class="zcc-status-container"></div>\n            </div>\n        </div>\n        <div class="zcc-row">\n            <div class="zcc-cell">\n                <div class="zcc-message-container">\n                    <div class="zcc-message-info-container"></div>\n                    <div class="zcc-message-duration-container"></div>\n                </div>\n            </div>\n        </div>--\x3e\n\n    </div>\n</div>');return buf.join("")}catch(err){rethrow(err,__stack.input,__stack.filename,__stack.lineno)}}},function(e,n,t){"use strict";var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"getElementsByClassName",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!n&&document&&(n=document);try{return n.getElementsByClassName(e)}catch(e){return null}}},{key:"getElementByClassName",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!n&&document&&(n=document);try{return n.getElementsByClassName(e)[0]}catch(e){return null}}},{key:"getClasses",value:function(e){return!!e&&e.className.split(/\s+/)}},{key:"hasClass",value:function(n,t){return!!n&&-1!==e.getClasses(n).indexOf(t)}},{key:"addClass",value:function(n,t){return!!n&&(e.hasClass(n,t)?void 0:n.className+=" "+t)}},{key:"setClasses",value:function(e,n){if(!e)return!1;e.className=n.join(" ")}},{key:"removeClass",value:function(e,n){if(!e)return!1;e.className=e.className.replace(new RegExp("( |^)"+n+"( |$)"),"$1$2")}}]),e}();e.exports=i},function(e,n){e.exports=function(e){var n="undefined"!=typeof window&&window.location;if(!n)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var t=n.protocol+"//"+n.host,r=t+n.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,n){var i,o=n.trim().replace(/^"(.*)"$/,function(e,n){return n}).replace(/^'(.*)'$/,function(e,n){return n});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?t+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(e,n,t){var r,i,o={},s=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=r.apply(this,arguments)),i}),a=function(e){var n={};return function(e){if("function"==typeof e)return e();if(void 0===n[e]){var t=function(e){return document.querySelector(e)}.call(this,e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}}(),c=null,l=0,u=[],d=t(15);function f(e,n){for(var t=0;t<e.length;t++){var r=e[t],i=o[r.id];if(i){i.refs++;for(var s=0;s<i.parts.length;s++)i.parts[s](r.parts[s]);for(;s<r.parts.length;s++)i.parts.push(y(r.parts[s],n))}else{var a=[];for(s=0;s<r.parts.length;s++)a.push(y(r.parts[s],n));o[r.id]={id:r.id,refs:1,parts:a}}}}function p(e,n){for(var t=[],r={},i=0;i<e.length;i++){var o=e[i],s=n.base?o[0]+n.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};r[s]?r[s].parts.push(a):t.push(r[s]={id:s,parts:[a]})}return t}function h(e,n){var t=a(e.insertInto);if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=u[u.length-1];if("top"===e.insertAt)r?r.nextSibling?t.insertBefore(n,r.nextSibling):t.appendChild(n):t.insertBefore(n,t.firstChild),u.push(n);else if("bottom"===e.insertAt)t.appendChild(n);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=a(e.insertInto+" "+e.insertAt.before);t.insertBefore(n,i)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var n=u.indexOf(e);n>=0&&u.splice(n,1)}function m(e){var n=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),g(n,e.attrs),h(e,n),n}function g(e,n){Object.keys(n).forEach(function(t){e.setAttribute(t,n[t])})}function y(e,n){var t,r,i,o;if(n.transform&&e.css){if(!(o=n.transform(e.css)))return function(){};e.css=o}if(n.singleton){var s=l++;t=c||(c=m(n)),r=E.bind(null,t,s,!1),i=E.bind(null,t,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(t=function(e){var n=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",g(n,e.attrs),h(e,n),n}(n),r=function(e,n,t){var r=t.css,i=t.sourceMap,o=void 0===n.convertToAbsoluteUrls&&i;(n.convertToAbsoluteUrls||o)&&(r=d(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var s=new Blob([r],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}.bind(null,t,n),i=function(){v(t),t.href&&URL.revokeObjectURL(t.href)}):(t=m(n),r=function(e,n){var t=n.css,r=n.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}.bind(null,t),i=function(){v(t)});return r(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;r(e=n)}else i()}}e.exports=function(e,n){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(n=n||{}).attrs="object"==typeof n.attrs?n.attrs:{},n.singleton||"boolean"==typeof n.singleton||(n.singleton=s()),n.insertInto||(n.insertInto="head"),n.insertAt||(n.insertAt="bottom");var t=p(e,n);return f(t,n),function(e){for(var r=[],i=0;i<t.length;i++){var s=t[i];(a=o[s.id]).refs--,r.push(a)}for(e&&f(p(e,n),n),i=0;i<r.length;i++){var a;if(0===(a=r[i]).refs){for(var c=0;c<a.parts.length;c++)a.parts[c]();delete o[a.id]}}}};var b,_=(b=[],function(e,n){return b[e]=n,b.filter(Boolean).join("\n")});function E(e,n,t,r){var i=t?"":r.css;if(e.styleSheet)e.styleSheet.cssText=_(n,i);else{var o=document.createTextNode(i),s=e.childNodes;s[n]&&e.removeChild(s[n]),s.length?e.insertBefore(o,s[n]):e.appendChild(o)}}},function(e,n){e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t=function(e,n){var t,r=e[1]||"",i=e[3];if(!i)return r;if(n&&"function"==typeof btoa){var o=(t=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"),s=i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"});return[r].concat(s).concat([o]).join("\n")}return[r].join("\n")}(n,e);return n[2]?"@media "+n[2]+"{"+t+"}":t}).join("")},n.i=function(e,t){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<e.length;i++){var s=e[i];"number"==typeof s[0]&&r[s[0]]||(t&&!s[2]?s[2]=t:t&&(s[2]="("+s[2]+") and ("+t+")"),n.push(s))}},n}},function(e,n,t){(e.exports=t(17)(!1)).push([e.i,'.zcc-widget-container {\n  all: initial;\n  display: table;\n  border: 1px solid silver;\n  border-radius: 5px;\n  background-color: white;\n  margin: 4px !important;\n  padding: 4px !important;\n  width: 400px !important;\n  height: 40px !important; }\n\n@keyframes color-sending {\n  0% {\n    background-color: red; }\n  50% {\n    background-color: #980000; }\n  100% {\n    background-color: red; } }\n\n@keyframes color-receiving {\n  0% {\n    background-color: green; }\n  50% {\n    background-color: #004800; }\n  100% {\n    background-color: green; } }\n  .zcc-widget-container .zcc-row {\n    all: initial;\n    display: table-row; }\n    .zcc-widget-container .zcc-row .zcc-cell {\n      all: initial;\n      display: table-cell; }\n      .zcc-widget-container .zcc-row .zcc-cell h4 {\n        all: initial;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;\n        font-size: 20px;\n        font-weight: 600;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap; }\n      .zcc-widget-container .zcc-row .zcc-cell .zcc-button-container {\n        all: initial; }\n        .zcc-widget-container .zcc-row .zcc-cell .zcc-button-container .zcc-button {\n          all: initial;\n          cursor: pointer;\n          display: inline-block;\n          min-width: 20px;\n          min-height: 20px;\n          width: 20px;\n          height: 20px;\n          border-radius: 30px;\n          background-color: #cccccc;\n          border: 2px solid #949494;\n          box-sizing: border-box; }\n          .zcc-widget-container .zcc-row .zcc-cell .zcc-button-container .zcc-button.zcc-receiving {\n            background-color: green;\n            animation-name: color-receiving;\n            animation-duration: 2s;\n            animation-iteration-count: infinite; }\n          .zcc-widget-container .zcc-row .zcc-cell .zcc-button-container .zcc-button.zcc-recording {\n            background-color: red;\n            animation-name: color-sending;\n            animation-duration: 2s;\n            animation-iteration-count: infinite; }\n      .zcc-widget-container .zcc-row .zcc-cell .zcc-state {\n        all: initial;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;\n        font-size: 14px;\n        font-weight: 600; }\n',""])},function(e,n,t){var r=t(18);"string"==typeof r&&(r=[[e.i,r,""]]);t(16)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,n,t){"use strict";var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=t(3),o=t(0),s=(t(19),t(14)),a=t(2),c=t(13),l=t(12),u=function(e){function n(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));if(t.options=e,!t.options.widget)throw new Error(o.ERROR_NOT_ENOUGH_PARAMS);if(!t.options.widget.element&&!t.options.widget.headless)throw new Error(o.ERROR_WIDGET_ELEMENT_NOT_FOUND);return t.isHeadless=!!t.options.widget.headless,t.isRecordingAvailable=t.options.recorder,t.element=t.options.widget.element,t.recorderOptions={streamPages:!0,numberOfChannels:1,encoderFrameSize:60,encoderBitRate:16e3,encoderSampleRate:16e3,maxBuffersPerPage:1},t.currentMessageTimer=null,t.currentRecordedMessageId=null,t.currentPacketId=0,t.init(),t}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,i),r(n,[{key:"parseHtmlForVariables",value:function(){for(var e=s.getElementsByClassName("zcc-js-el",this.element),n=0;n<e.length;n++){var t=e[n],r=a.strToCamelCase(t.className.split(/ /)[0]);if(void 0!==this[r])throw new Error("markup conflict");this[r]=e[n]}}},{key:"initHtml",value:function(){this.element.innerHTML=c(),this.parseHtmlForVariables()}},{key:"startMessage",value:function(){var e=this;this.emit(o.EVENT_START_STREAM),this.session.startStream({type:"audio",codec:"opus",codec_header:n.buildCodecHeader(this.recorderOptions.encoderSampleRate,this.recorderOptions.maxBuffersPerPage,this.recorderOptions.encoderFrameSize),packet_duration:60}).then(function(n){e.currentRecordedMessageId=n.stream_id,e.doRecordMessage()}).fail(function(n){e.emit(o.EVENT_ERROR,n)})}},{key:"doRecordMessage",value:function(){var e=this;s.addClass(this.button,"zcc-recording"),this.recorder.onopusdataavailable=function(t){var r=n.buildBinaryPacket(1,e.currentRecordedMessageId,e.currentPacketId,t);e.currentPacketId++,e.session.sendBinary(r)},this.recorder.start()}},{key:"stopRecordMessage",value:function(){s.removeClass(this.button,"zcc-recording"),this.currentRecordedMessageId=null,this.recorder.stop()}},{key:"buttonPressHandler",value:function(){this.emit(o.EVENT_BUTTON_PRESS),this.currentRecordedMessageId?this.stopMessage():this.startMessage()}},{key:"stopMessage",value:function(){var e=this;this.emit(o.EVENT_STOP_STREAM),this.session.stopStream({stream_id:this.currentRecordedMessageId}).then(function(n){e.stopRecordMessage()}).fail(function(n){e.emit(o.EVENT_ERROR,n)})}},{key:"initPlayer",value:function(){var e=this,n=a.getLoadedLibrary();this.decoder=new n.Player.Decoder.OpusToPCM({channels:1,fallback:!0}),this.player=new n.Player.PCMPlayer({encoding:"32bitFloat",channels:1,sampleRate:this.decoder.getSampleRate(),flushingTime:100}),this.decoder.on("decode",function(n){e.player.feed(n)}),this.isRecordingAvailable&&(this.recorder=new n.Recorder(this.recorderOptions))}},{key:"init",value:function(){this.isHeadless||this.initHtml(),this.initPlayer(),this.playOn=!0}},{key:"updateHeader",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n.updateHtml(this.zccInfoHeader,e,t)}},{key:"updateState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n.updateHtml(this.zccState,e,t)}},{key:"setSession",value:function(e){var n=this;this.session=e,this.updateHeader(e.options.channel),this.session.on(o.EVENT_STATUS,function(e){n.updateState(l,e)}),this.session.on(o.EVENT_STREAM_START,function(e){n.incomingMessageStart(e)}),this.session.on(o.EVENT_STREAM_STOP,function(e){n.incomingMessageEnd(e)}),this.session.on(o.EVENT_INCOMING_VOICE_DATA,function(e){n.playOn&&n.decoder.decode(e.messageData)})}},{key:"incomingMessageStart",value:function(e){var t=this,r=Date.now();this.currentMessageTimer=setInterval(function(){var e=Date.now()-r;t.isHeadless||(t.messageDurationContainer.innerHTML=n.getDurationDisplay(e))},100),this.isHeadless||(this.messageInfoContainer.innerHTML=MessageInfoTemplate(e),s.addClass(this.button,"zcc-receiving"))}},{key:"incomingMessageEnd",value:function(){clearInterval(this.currentMessageTimer),this.isHeadless||(this.messageDurationContainer.innerHTML="",this.messageInfoContainer.innerHTML="",s.removeClass(this.button,"zcc-receiving"))}},{key:"pausePlayer",value:function(){this.playOn=!1}},{key:"resumePlayer",value:function(){this.playOn=!0}},{key:"disconnect",value:function(){this.session.disconnect()}},{key:"destroy",value:function(){this.disconnect(),this.element.remove()}}],[{key:"updateHtml",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return!1;var r=n;"function"==typeof n&&(r=n.apply(n,[t])),e.innerHTML=r}},{key:"getDurationDisplay",value:function(e){var n=Math.floor(e/36e5),t=Math.floor(e/6e4%60),r=Math.floor(e/1e3%60),i=Math.round(e%1e3/100);return i>=10&&(i=9),n>0&&n<10&&(n="0"+n),t>0&&t<10&&(t="0"+t),r>0&&r<10&&(r="0"+r),n?n+":"+t+":"+r+"."+i:t?t+":"+r+"."+i:r?"00:"+r+"."+i:"00:00."+i}},{key:"buildBinaryPacket",value:function(e,t,r,i){var o=new ArrayBuffer(9),s=new DataView(o);return s.setInt8(0,e),s.setInt32(1,t,!1),s.setInt32(5,r,!1),new Uint8Array(n.arrayBufferConcat(o,i))}},{key:"buildCodecHeader",value:function(e,n,t){var r=new ArrayBuffer(4),i=new DataView(r);return i.setUint16(0,e,!0),i.setUint8(2,n),i.setUint8(3,t),btoa(String.fromCharCode.apply(null,new Uint8Array(r)))}},{key:"arrayBufferConcat",value:function(){var e=0,n=null;for(var t in arguments)e+=(n=arguments[t]).byteLength;var r=new Uint8Array(e),i=0;for(var o in arguments)n=arguments[o],r.set(new Uint8Array(n),i),i+=n.byteLength;return r.buffer}}]),n}();e.exports=u}])});